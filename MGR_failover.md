## 一、开启压测，进行到50左右时，查看proxysql监控，可以看到从节点积压了10000+事务，此时关闭primary 节点，模拟failover
 ```sh
 [root@l-betadb2.ops.p1 ~]# sh mgr_sysbench.sh run
sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 10
Report intermediate results every 5 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

[ 5s ] thds: 10 tps: 115.49 qps: 2330.26 (r/w/o: 1635.10/462.18/232.99) lat (ms,95%): 231.53 err/s: 0.00 reconn/s: 0.00
[ 10s ] thds: 10 tps: 186.49 qps: 3733.51 (r/w/o: 2613.20/747.34/372.97) lat (ms,95%): 167.44 err/s: 0.00 reconn/s: 0.00
[ 15s ] thds: 10 tps: 203.00 qps: 4054.86 (r/w/o: 2838.44/810.41/406.01) lat (ms,95%): 142.39 err/s: 0.00 reconn/s: 0.00
[ 20s ] thds: 10 tps: 214.77 qps: 4296.76 (r/w/o: 3007.95/859.27/429.54) lat (ms,95%): 155.80 err/s: 0.00 reconn/s: 0.00
[ 25s ] thds: 10 tps: 225.43 qps: 4509.32 (r/w/o: 3156.16/902.30/450.85) lat (ms,95%): 142.39 err/s: 0.00 reconn/s: 0.00
[ 30s ] thds: 10 tps: 327.19 qps: 6546.08 (r/w/o: 4583.51/1308.18/654.39) lat (ms,95%): 92.42 err/s: 0.00 reconn/s: 0.00
[ 35s ] thds: 10 tps: 335.61 qps: 6710.32 (r/w/o: 4695.48/1343.62/671.21) lat (ms,95%): 99.33 err/s: 0.00 reconn/s: 0.00
[ 40s ] thds: 10 tps: 332.19 qps: 6650.26 (r/w/o: 4656.70/1329.17/664.39) lat (ms,95%): 114.72 err/s: 0.00 reconn/s: 0.00
[ 45s ] thds: 10 tps: 360.21 qps: 7198.60 (r/w/o: 5039.14/1439.04/720.42) lat (ms,95%): 110.66 err/s: 0.00 reconn/s: 0.00
[ 50s ] thds: 10 tps: 559.79 qps: 11193.08 (r/w/o: 7834.12/2239.38/1119.59) lat (ms,95%): 59.99 err/s: 0.00 reconn/s: 0.00
FATAL: mysql_drv_query() returned error 2013 (Lost connection to MySQL server during query) for query 'INSERT INTO sbtest9 (id, k, c, pad) VALUES (249000, 252487, '71221575984-04697677323-89261384742-77565599962-62199424605-37876875604-96121277273-78150862091-80026952738-06247368980', '55934699707-20236598564-58014912225-33408233751-27856359256')'
FATAL: mysql_drv_query() returned error 2013 (Lost connection to MySQL server during query) for query 'SELECT c FROM sbtest8 WHERE id BETWEEN 250791 AND 250890'
FATAL: mysql_drv_query() returned error 2013 (Lost connection to MySQL server during query) for query 'SELECT c FROM sbtest8 WHERE id=250533'
FATAL: mysql_drv_query() returned error 2013 (Lost connection to MySQL server during query) for query 'SELECT DISTINCT c FROM sbtest10 WHERE id BETWEEN 247263 AND 247362 ORDER BY c'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:103: db_query() failed
FATAL: mysql_drv_query() returned error 2013 (Lost connection to MySQL server during query) for query 'SELECT SUM(K) FROM sbtest8 WHERE id BETWEEN 251162 AND 251261'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:69: db_query() failed
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:49: db_query() failed
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:60: db_query() failed
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:56: db_query() failed
FATAL: mysql_drv_query() returned error 2013 (Lost connection to MySQL server during query) for query 'SELECT c FROM sbtest3 WHERE id=176912'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:49: db_query() failed
FATAL: mysql_drv_query() returned error 2013 (Lost connection to MySQL server during query) for query 'SELECT c FROM sbtest10 WHERE id=331440'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:49: db_query() failed
FATAL: mysql_drv_query() returned error 2013 (Lost connection to MySQL server during query) for query 'SELECT c FROM sbtest7 WHERE id=157244'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:49: db_query() failed
FATAL: mysql_drv_query() returned error 2013 (Lost connection to MySQL server during query) for query 'SELECT c FROM sbtest3 WHERE id=161173'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:49: db_query() failed
Error in my_thread_global_end(): 9 threads didn't exit
```
## 二、proxyql整个过程监控如下
```
Admin>select * from mysql_server_group_replication_log order by time_start_us;
+--------------+------+------------------+-----------------+------------------+-----------+---------------------+-----------------------------+
| hostname     | port | time_start_us    | success_time_us | viable_candidate | read_only | transactions_behind | error                       |
+--------------+------+------------------+-----------------+------------------+-----------+---------------------+-----------------------------+
| 172.18.0.151 | 3317 | 1591154643181874 | 2323            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154688185265 | 2560            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154689185329 | 3318            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154690185468 | 2140            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154691185620 | 3159            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154692185675 | 1748            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154693185706 | 1913            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154694185719 | 1901            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154695185889 | 2309            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154696185920 | 1808            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.151 | 3317 | 1591154697185965 | 2619            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154697186360 | 1990            | YES              | YES       | 465                 | NULL                        | 开始压测 152和160事务出现延时
| 172.18.0.160 | 3317 | 1591154697186725 | 3265            | YES              | YES       | 308                 | NULL                        |
| 172.18.0.151 | 3317 | 1591154698186017 | 2228            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154698186435 | 2587            | YES              | YES       | 590                 | NULL                        |
| 172.18.0.160 | 3317 | 1591154698186801 | 2563            | YES              | YES       | 477                 | NULL                        |
| 172.18.0.151 | 3317 | 1591154699186084 | 2118            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154699186505 | 2203            | YES              | YES       | 696                 | NULL                        |
| 172.18.0.160 | 3317 | 1591154699186899 | 1867            | YES              | YES       | 620                 | NULL                        |
| 172.18.0.151 | 3317 | 1591154700186136 | 2368            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154700186505 | 2663            | YES              | YES       | 825                 | NULL                        |
| 172.18.0.160 | 3317 | 1591154700186940 | 2542            | YES              | YES       | 752                 | NULL                        |
| 172.18.0.151 | 3317 | 1591154701186215 | 2134            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154701186558 | 2137            | YES              | YES       | 958                 | NULL                        |
| 172.18.0.160 | 3317 | 1591154701186951 | 1955            | YES              | YES       | 904                 | NULL                        |
| 172.18.0.151 | 3317 | 1591154702186259 | 2596            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154702186665 | 2081            | YES              | YES       | 1124                | NULL                        |
| 172.18.0.160 | 3317 | 1591154702187134 | 2215            | YES              | YES       | 1065                | NULL                        |
| 172.18.0.151 | 3317 | 1591154703186370 | 2130            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154703186752 | 2297            | YES              | YES       | 1326                | NULL                        |
| 172.18.0.160 | 3317 | 1591154703187162 | 1803            | YES              | YES       | 1254                | NULL                        |
| 172.18.0.151 | 3317 | 1591154704186483 | 2445            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154704186889 | 2435            | YES              | YES       | 1491                | NULL                        |
| 172.18.0.160 | 3317 | 1591154704187296 | 1918            | YES              | YES       | 1416                | NULL                        |
| 172.18.0.151 | 3317 | 1591154705186492 | 1913            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154705186898 | 1979            | YES              | YES       | 1657                | NULL                        |
| 172.18.0.160 | 3317 | 1591154705187277 | 1908            | YES              | YES       | 1574                | NULL                        |
| 172.18.0.151 | 3317 | 1591154706186543 | 2114            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154706186919 | 2762            | YES              | YES       | 1841                | NULL                        |
| 172.18.0.160 | 3317 | 1591154706187297 | 1918            | YES              | YES       | 1768                | NULL                        |
| 172.18.0.151 | 3317 | 1591154707186654 | 1997            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154707187053 | 2068            | YES              | YES       | 2034                | NULL                        |
| 172.18.0.160 | 3317 | 1591154707187463 | 1828            | YES              | YES       | 1937                | NULL                        |
| 172.18.0.151 | 3317 | 1591154708186712 | 2167            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154708187101 | 2059            | YES              | YES       | 2200                | NULL                        |
| 172.18.0.160 | 3317 | 1591154708187480 | 1849            | YES              | YES       | 2093                | NULL                        |
| 172.18.0.151 | 3317 | 1591154709186805 | 1984            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154709187209 | 3697            | YES              | YES       | 2361                | NULL                        |
| 172.18.0.160 | 3317 | 1591154709187596 | 2640            | YES              | YES       | 2257                | NULL                        |
| 172.18.0.151 | 3317 | 1591154710186905 | 2046            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154710187294 | 2027            | YES              | YES       | 2550                | NULL                        |
| 172.18.0.160 | 3317 | 1591154710187675 | 1757            | YES              | YES       | 2444                | NULL                        |
| 172.18.0.151 | 3317 | 1591154711186946 | 2389            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154711187411 | 3256            | YES              | YES       | 2697                | NULL                        |
| 172.18.0.160 | 3317 | 1591154711187764 | 2075            | YES              | YES       | 2522                | NULL                        |
| 172.18.0.151 | 3317 | 1591154712187023 | 1861            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154712187378 | 2086            | YES              | YES       | 2852                | NULL                        |
| 172.18.0.160 | 3317 | 1591154712187759 | 1776            | YES              | YES       | 2665                | NULL                        |
| 172.18.0.151 | 3317 | 1591154713187073 | 2869            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154713187490 | 2582            | YES              | YES       | 3008                | NULL                        |
| 172.18.0.160 | 3317 | 1591154713187879 | 2088            | YES              | YES       | 2814                | NULL                        |
| 172.18.0.151 | 3317 | 1591154714187171 | 2624            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154714187549 | 3613            | YES              | YES       | 3175                | NULL                        |
| 172.18.0.160 | 3317 | 1591154714187949 | 1942            | YES              | YES       | 2898                | NULL                        |
| 172.18.0.151 | 3317 | 1591154715187245 | 1789            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154715187669 | 2520            | YES              | YES       | 3353                | NULL                        |
| 172.18.0.160 | 3317 | 1591154715188037 | 1802            | YES              | YES       | 3022                | NULL                        |
| 172.18.0.151 | 3317 | 1591154716187346 | 1990            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154716187742 | 2293            | YES              | YES       | 3537                | NULL                        |
| 172.18.0.160 | 3317 | 1591154716188215 | 1943            | YES              | YES       | 3211                | NULL                        |
| 172.18.0.151 | 3317 | 1591154717187344 | 2173            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154717187747 | 2011            | YES              | YES       | 3807                | NULL                        |
| 172.18.0.160 | 3317 | 1591154717188160 | 1866            | YES              | YES       | 3506                | NULL                        |
| 172.18.0.151 | 3317 | 1591154718187395 | 2214            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154718187857 | 2790            | YES              | YES       | 4078                | NULL                        |
| 172.18.0.160 | 3317 | 1591154718188265 | 1832            | YES              | YES       | 3780                | NULL                        |
| 172.18.0.151 | 3317 | 1591154719187484 | 1828            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154719187876 | 2370            | YES              | YES       | 4376                | NULL                        |
| 172.18.0.160 | 3317 | 1591154719188272 | 2138            | YES              | YES       | 4110                | NULL                        |
| 172.18.0.151 | 3317 | 1591154720187524 | 2391            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154720187933 | 2824            | YES              | YES       | 4609                | NULL                        |
| 172.18.0.160 | 3317 | 1591154720188350 | 1805            | YES              | YES       | 4383                | NULL                        |
| 172.18.0.151 | 3317 | 1591154721187655 | 2138            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154721188076 | 2131            | YES              | YES       | 4936                | NULL                        |
| 172.18.0.160 | 3317 | 1591154721188421 | 1896            | YES              | YES       | 4693                | NULL                        |
| 172.18.0.151 | 3317 | 1591154722187628 | 2153            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154722187991 | 2299            | YES              | YES       | 5270                | NULL                        |
| 172.18.0.160 | 3317 | 1591154722188365 | 1992            | YES              | YES       | 5045                | NULL                        |
| 172.18.0.151 | 3317 | 1591154723187661 | 2221            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154723188041 | 2105            | YES              | YES       | 5554                | NULL                        |
| 172.18.0.160 | 3317 | 1591154723188461 | 2023            | YES              | YES       | 5322                | NULL                        |
| 172.18.0.151 | 3317 | 1591154724187787 | 2332            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154724188175 | 3440            | YES              | YES       | 5845                | NULL                        |
| 172.18.0.160 | 3317 | 1591154724188567 | 2672            | YES              | YES       | 5650                | NULL                        |
| 172.18.0.151 | 3317 | 1591154725187871 | 2549            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154725188281 | 2405            | YES              | YES       | 6209                | NULL                        |
| 172.18.0.160 | 3317 | 1591154725189295 | 2285            | YES              | YES       | 6004                | NULL                        |
| 172.18.0.151 | 3317 | 1591154726187916 | 2293            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154726188341 | 2224            | YES              | YES       | 6418                | NULL                        |
| 172.18.0.160 | 3317 | 1591154726188743 | 2100            | YES              | YES       | 6274                | NULL                        |
| 172.18.0.151 | 3317 | 1591154727188004 | 2351            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154727188419 | 2193            | YES              | YES       | 6700                | NULL                        |
| 172.18.0.160 | 3317 | 1591154727188809 | 1844            | YES              | YES       | 6588                | NULL                        |
| 172.18.0.151 | 3317 | 1591154728188038 | 2179            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154728188406 | 2564            | YES              | YES       | 6905                | NULL                        |
| 172.18.0.160 | 3317 | 1591154728188797 | 2035            | YES              | YES       | 6816                | NULL                        |
| 172.18.0.151 | 3317 | 1591154729188060 | 2302            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154729188436 | 2449            | YES              | YES       | 7172                | NULL                        |
| 172.18.0.160 | 3317 | 1591154729188858 | 2213            | YES              | YES       | 7104                | NULL                        |
| 172.18.0.151 | 3317 | 1591154730188135 | 1957            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154730188552 | 3620            | YES              | YES       | 7455                | NULL                        |
| 172.18.0.160 | 3317 | 1591154730188963 | 3411            | YES              | YES       | 7410                | NULL                        |
| 172.18.0.151 | 3317 | 1591154731188188 | 2350            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154731188572 | 2141            | YES              | YES       | 7767                | NULL                        |
| 172.18.0.160 | 3317 | 1591154731188949 | 1991            | YES              | YES       | 7655                | NULL                        |
| 172.18.0.151 | 3317 | 1591154732188302 | 2440            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154732188666 | 1946            | YES              | YES       | 8068                | NULL                        |
| 172.18.0.160 | 3317 | 1591154732189047 | 1886            | YES              | YES       | 7948                | NULL                        |
| 172.18.0.151 | 3317 | 1591154733188370 | 1949            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154733188783 | 2163            | YES              | YES       | 8289                | NULL                        |
| 172.18.0.160 | 3317 | 1591154733189169 | 2499            | YES              | YES       | 8041                | NULL                        |
| 172.18.0.151 | 3317 | 1591154734188420 | 2248            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154734188780 | 2135            | YES              | YES       | 8513                | NULL                        |
| 172.18.0.160 | 3317 | 1591154734189154 | 1830            | YES              | YES       | 8178                | NULL                        |
| 172.18.0.151 | 3317 | 1591154735188479 | 2339            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154735188883 | 3247            | YES              | YES       | 8860                | NULL                        |
| 172.18.0.160 | 3317 | 1591154735189305 | 2215            | YES              | YES       | 8510                | NULL                        |
| 172.18.0.151 | 3317 | 1591154736188513 | 2483            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154736188928 | 1980            | YES              | YES       | 9322                | NULL                        |
| 172.18.0.160 | 3317 | 1591154736189306 | 2655            | YES              | YES       | 8962                | NULL                        |
| 172.18.0.151 | 3317 | 1591154737188563 | 2224            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154737188911 | 2471            | YES              | YES       | 9786                | NULL                        |
| 172.18.0.160 | 3317 | 1591154737189294 | 2309            | YES              | YES       | 9394                | NULL                        |
| 172.18.0.151 | 3317 | 1591154738188610 | 2951            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154738189016 | 2362            | YES              | YES       | 10331               | NULL                        |
| 172.18.0.160 | 3317 | 1591154738189428 | 1835            | YES              | YES       | 9949                | NULL                        |
| 172.18.0.151 | 3317 | 1591154739188675 | 2211            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154739189052 | 2251            | YES              | YES       | 10842               | NULL                        |
| 172.18.0.160 | 3317 | 1591154739189487 | 2081            | YES              | YES       | 10493               | NULL                        |
| 172.18.0.151 | 3317 | 1591154740188763 | 2713            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154740189146 | 2685            | YES              | YES       | 11401               | NULL                        |
| 172.18.0.160 | 3317 | 1591154740189531 | 2568            | YES              | YES       | 11041               | NULL                        |
| 172.18.0.151 | 3317 | 1591154741188809 | 2875            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154741189216 | 2261            | YES              | YES       | 11922               | NULL                        |
| 172.18.0.160 | 3317 | 1591154741189609 | 2006            | YES              | YES       | 11524               | NULL                        |
| 172.18.0.151 | 3317 | 1591154742188948 | 0               | NO               | YES       | -1                  | Server shutdown in progress | #关闭原主节点151 
| 172.18.0.152 | 3317 | 1591154742189340 | 2293            | YES              | YES       | 12016               | NULL                        |
| 172.18.0.160 | 3317 | 1591154742189722 | 1916            | YES              | YES       | 11653               | NULL                        |
| 172.18.0.152 | 3317 | 1591154743189437 | 2226            | YES              | YES       | 11767               | NULL                        |
| 172.18.0.160 | 3317 | 1591154743189806 | 1959            | YES              | YES       | 11359               | NULL                        |
| 172.18.0.152 | 3317 | 1591154744189493 | 2473            | YES              | NO        | 11592               | NULL                        | #3秒后152选为新的主库 read_only 更改为NO 
| 172.18.0.160 | 3317 | 1591154744189885 | 1817            | YES              | YES       | 11195               | NULL                        | #此时152和160中仍然有为应用晚测事务
| 172.18.0.152 | 3317 | 1591154745189638 | 2348            | YES              | NO        | 11528               | NULL                        |
| 172.18.0.160 | 3317 | 1591154745189989 | 1934            | YES              | YES       | 11191               | NULL                        |
| 172.18.0.152 | 3317 | 1591154746189611 | 2059            | YES              | NO        | 11350               | NULL                        |
| 172.18.0.160 | 3317 | 1591154746189887 | 2902            | YES              | YES       | 11056               | NULL                        |
| 172.18.0.152 | 3317 | 1591154747189797 | 2181            | YES              | NO        | 11172               | NULL                        |
| 172.18.0.160 | 3317 | 1591154747190208 | 2086            | YES              | YES       | 10780               | NULL                        |
| 172.18.0.152 | 3317 | 1591154748189777 | 2139            | YES              | NO        | 10866               | NULL                        |
| 172.18.0.160 | 3317 | 1591154748190130 | 1964            | YES              | YES       | 10392               | NULL                        |
| 172.18.0.152 | 3317 | 1591154749189855 | 2133            | YES              | NO        | 10668               | NULL                        |
| 172.18.0.160 | 3317 | 1591154749190256 | 2271            | YES              | YES       | 10079               | NULL                        |
| 172.18.0.152 | 3317 | 1591154750189959 | 2018            | YES              | NO        | 10320               | NULL                        |
| 172.18.0.160 | 3317 | 1591154750190392 | 2295            | YES              | YES       | 9694                | NULL                        |
| 172.18.0.152 | 3317 | 1591154751190024 | 2207            | YES              | NO        | 10040               | NULL                        |
| 172.18.0.160 | 3317 | 1591154751190428 | 1994            | YES              | YES       | 9404                | NULL                        |
| 172.18.0.152 | 3317 | 1591154752190078 | 2116            | YES              | NO        | 9816                | NULL                        |
| 172.18.0.160 | 3317 | 1591154752190459 | 2186            | YES              | YES       | 9187                | NULL                        |
| 172.18.0.152 | 3317 | 1591154753190103 | 3337            | YES              | NO        | 9573                | NULL                        |
| 172.18.0.160 | 3317 | 1591154753190535 | 2325            | YES              | YES       | 8987                | NULL                        |
| 172.18.0.152 | 3317 | 1591154754190117 | 2865            | YES              | NO        | 9337                | NULL                        |
| 172.18.0.160 | 3317 | 1591154754190509 | 2845            | YES              | YES       | 8763                | NULL                        |
| 172.18.0.152 | 3317 | 1591154755190420 | 2369            | YES              | NO        | 9072                | NULL                        |
| 172.18.0.160 | 3317 | 1591154755190842 | 3022            | YES              | YES       | 8449                | NULL                        |
| 172.18.0.152 | 3317 | 1591154756190388 | 2157            | YES              | NO        | 8843                | NULL                        |
| 172.18.0.160 | 3317 | 1591154756190711 | 2449            | YES              | YES       | 8207                | NULL                        |
| 172.18.0.152 | 3317 | 1591154757190559 | 2230            | YES              | NO        | 8581                | NULL                        |
| 172.18.0.160 | 3317 | 1591154757190955 | 3152            | YES              | YES       | 7946                | NULL                        |
| 172.18.0.152 | 3317 | 1591154758190527 | 2264            | YES              | NO        | 8417                | NULL                        |
| 172.18.0.160 | 3317 | 1591154758190909 | 1880            | YES              | YES       | 7788                | NULL                        |
| 172.18.0.152 | 3317 | 1591154759190754 | 3167            | YES              | NO        | 8111                | NULL                        |
| 172.18.0.160 | 3317 | 1591154759191182 | 3288            | YES              | YES       | 7581                | NULL                        |
| 172.18.0.152 | 3317 | 1591154760190734 | 2890            | YES              | NO        | 7752                | NULL                        |
| 172.18.0.160 | 3317 | 1591154760191189 | 2324            | YES              | YES       | 7321                | NULL                        |
| 172.18.0.152 | 3317 | 1591154761190851 | 2111            | YES              | NO        | 7629                | NULL                        |
| 172.18.0.160 | 3317 | 1591154761191302 | 3351            | YES              | YES       | 7271                | NULL                        |
| 172.18.0.152 | 3317 | 1591154762190916 | 2624            | YES              | NO        | 7366                | NULL                        |
| 172.18.0.160 | 3317 | 1591154762191336 | 2568            | YES              | YES       | 7031                | NULL                        |
| 172.18.0.152 | 3317 | 1591154763190940 | 2237            | YES              | NO        | 7127                | NULL                        |
| 172.18.0.160 | 3317 | 1591154763191366 | 2325            | YES              | YES       | 6763                | NULL                        |
| 172.18.0.152 | 3317 | 1591154764190749 | 3310            | YES              | NO        | 6918                | NULL                        |
| 172.18.0.160 | 3317 | 1591154764191087 | 1901            | YES              | YES       | 6514                | NULL                        |
| 172.18.0.152 | 3317 | 1591154765190778 | 2803            | YES              | NO        | 6739                | NULL                        |
| 172.18.0.160 | 3317 | 1591154765191210 | 2839            | YES              | YES       | 6211                | NULL                        |
| 172.18.0.152 | 3317 | 1591154766190870 | 2960            | YES              | NO        | 6379                | NULL                        |
| 172.18.0.160 | 3317 | 1591154766191294 | 2762            | YES              | YES       | 5765                | NULL                        |
| 172.18.0.152 | 3317 | 1591154767190991 | 2337            | YES              | NO        | 6167                | NULL                        |
| 172.18.0.160 | 3317 | 1591154767191340 | 2487            | YES              | YES       | 5423                | NULL                        |
| 172.18.0.152 | 3317 | 1591154768191188 | 2107            | YES              | NO        | 5931                | NULL                        |
| 172.18.0.160 | 3317 | 1591154768191528 | 2135            | YES              | YES       | 5115                | NULL                        |
| 172.18.0.152 | 3317 | 1591154769191048 | 6006            | YES              | NO        | 5630                | NULL                        |
| 172.18.0.160 | 3317 | 1591154769191440 | 2322            | YES              | YES       | 4709                | NULL                        |
| 172.18.0.152 | 3317 | 1591154770191067 | 2112            | YES              | NO        | 5314                | NULL                        |
| 172.18.0.160 | 3317 | 1591154770191441 | 1807            | YES              | YES       | 4300                | NULL                        |
| 172.18.0.152 | 3317 | 1591154771191284 | 2992            | YES              | NO        | 5216                | NULL                        |
| 172.18.0.160 | 3317 | 1591154771191661 | 1973            | YES              | YES       | 4142                | NULL                        |
| 172.18.0.152 | 3317 | 1591154772191296 | 2263            | YES              | NO        | 4895                | NULL                        |
| 172.18.0.160 | 3317 | 1591154772191677 | 2443            | YES              | YES       | 3771                | NULL                        |
| 172.18.0.152 | 3317 | 1591154773191437 | 2389            | YES              | NO        | 4735                | NULL                        |
| 172.18.0.160 | 3317 | 1591154773191896 | 2051            | YES              | YES       | 3665                | NULL                        |
| 172.18.0.152 | 3317 | 1591154774191427 | 2389            | YES              | NO        | 4320                | NULL                        |
| 172.18.0.160 | 3317 | 1591154774191890 | 1897            | YES              | YES       | 3320                | NULL                        |
| 172.18.0.152 | 3317 | 1591154775191451 | 3843            | YES              | NO        | 4124                | NULL                        |
| 172.18.0.160 | 3317 | 1591154775191894 | 2819            | YES              | YES       | 3181                | NULL                        |
| 172.18.0.152 | 3317 | 1591154776191610 | 2200            | YES              | NO        | 3956                | NULL                        |
| 172.18.0.160 | 3317 | 1591154776191960 | 2594            | YES              | YES       | 3046                | NULL                        |
| 172.18.0.152 | 3317 | 1591154777191539 | 2924            | YES              | NO        | 3672                | NULL                        |
| 172.18.0.160 | 3317 | 1591154777191966 | 1976            | YES              | YES       | 2772                | NULL                        |
| 172.18.0.152 | 3317 | 1591154778191674 | 3566            | YES              | NO        | 3424                | NULL                        |
| 172.18.0.160 | 3317 | 1591154778192042 | 2253            | YES              | YES       | 2544                | NULL                        |
| 172.18.0.152 | 3317 | 1591154779191845 | 2174            | YES              | NO        | 3129                | NULL                        |
| 172.18.0.160 | 3317 | 1591154779192231 | 2879            | YES              | YES       | 2266                | NULL                        |
| 172.18.0.152 | 3317 | 1591154780191894 | 2292            | YES              | NO        | 2731                | NULL                        |
| 172.18.0.160 | 3317 | 1591154780192258 | 2057            | YES              | YES       | 1904                | NULL                        |
| 172.18.0.152 | 3317 | 1591154781191982 | 2139            | YES              | NO        | 2621                | NULL                        |
| 172.18.0.160 | 3317 | 1591154781192372 | 2116            | YES              | YES       | 1640                | NULL                        |
| 172.18.0.152 | 3317 | 1591154782192056 | 4057            | YES              | NO        | 2486                | NULL                        |
| 172.18.0.160 | 3317 | 1591154782192485 | 2235            | YES              | YES       | 1344                | NULL                        |
| 172.18.0.152 | 3317 | 1591154783192204 | 2074            | YES              | NO        | 2281                | NULL                        |
| 172.18.0.160 | 3317 | 1591154783192563 | 2102            | YES              | YES       | 998                 | NULL                        |
| 172.18.0.152 | 3317 | 1591154784192302 | 2494            | YES              | NO        | 1913                | NULL                        |
| 172.18.0.160 | 3317 | 1591154784192668 | 3185            | YES              | YES       | 615                 | NULL                        |
| 172.18.0.152 | 3317 | 1591154785192298 | 2022            | YES              | NO        | 1669                | NULL                        |
| 172.18.0.160 | 3317 | 1591154785192722 | 2496            | YES              | YES       | 273                 | NULL                        |
| 172.18.0.152 | 3317 | 1591154786192432 | 2566            | YES              | NO        | 1474                | NULL                        |
| 172.18.0.160 | 3317 | 1591154786192775 | 3071            | YES              | YES       | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154787192417 | 2158            | YES              | NO        | 1142                | NULL                        |
| 172.18.0.160 | 3317 | 1591154787192842 | 1787            | YES              | YES       | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154788192518 | 2170            | YES              | NO        | 673                 | NULL                        |
| 172.18.0.160 | 3317 | 1591154788192987 | 2210            | YES              | YES       | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154789192620 | 2692            | YES              | NO        | 224                 | NULL                        |
| 172.18.0.160 | 3317 | 1591154789193000 | 2343            | YES              | YES       | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154790192641 | 2218            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.160 | 3317 | 1591154790193009 | 2789            | YES              | YES       | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154791192777 | 1999            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.160 | 3317 | 1591154791193181 | 1984            | YES              | YES       | 35                  | NULL                        |
| 172.18.0.152 | 3317 | 1591154792192806 | 2616            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.160 | 3317 | 1591154792193258 | 2449            | YES              | YES       | 15                  | NULL                        |
| 172.18.0.152 | 3317 | 1591154793192817 | 1941            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.160 | 3317 | 1591154793193225 | 2381            | YES              | YES       | 0                   | NULL                        |
| 172.18.0.152 | 3317 | 1591154794192919 | 2272            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.160 | 3317 | 1591154794193350 | 2115            | YES              | YES       | 10                  | NULL                        |
| 172.18.0.152 | 3317 | 1591154795192988 | 1787            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.160 | 3317 | 1591154795193375 | 2045            | YES              | YES       | 17                  | NULL                        |
| 172.18.0.152 | 3317 | 1591154796193034 | 2137            | YES              | NO        | 0                   | NULL                        |
| 172.18.0.160 | 3317 | 1591154796193493 | 2137            | YES              | YES       | 12                  | NULL                        |
+--------------+------+------------------+-----------------+------------------+-----------+---------------------+-----------------------------+
300 rows in set (0.00 sec)
```

## 三、在主库选举完成，但是事务未应用完成时，测试是否可以写入，如下开启oltp压测脚本，根据结果显示事务均无法提交,大概持续45s.

为了模拟事务堆积情况，该集群中节点性能较弱，实际中，主从节点的延时控制在1秒内
```sh
[root@l-betadb2.ops.p1 ~]# sh mgr_sysbench.sh run
sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 10
Report intermediate results every 5 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
Error in my_thread_global_end(): 9 threads didn't exit
[root@l-betadb2.ops.p1 ~]# sh mgr_sysbench.sh run
sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 10
Report intermediate results every 5 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
Error in my_thread_global_end(): 8 threads didn't exit
[root@l-betadb2.ops.p1 ~]# sh mgr_sysbench.sh run
sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 10
Report intermediate results every 5 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
Error in my_thread_global_end(): 6 threads didn't exit
[root@l-betadb2.ops.p1 ~]# sh mgr_sysbench.sh run
sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 10
Report intermediate results every 5 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed
FATAL: mysql_drv_query() returned error 3101 (Plugin instructed the server to rollback the current transaction.) for query 'COMMIT'
FATAL: `thread_run' function failed: ./sysbench-1.0.20/tests/include/oltp_legacy/oltp.lua:110: db_query() failed

Error in my_thread_global_end(): 6 threads didn't exit
```


## 四、在新主库将原主库传来的事务应用完成后再次测试是否可写入，结果表明只有当原主库事务应用完成后，新primary节点才能写入数据。
```sh
[root@l-betadb2.ops.p1 ~]# sh mgr_sysbench.sh run
sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 10
Report intermediate results every 5 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

[ 5s ] thds: 10 tps: 83.53 qps: 1686.89 (r/w/o: 1183.34/334.50/169.05) lat (ms,95%): 369.77 err/s: 0.00 reconn/s: 0.00
[ 10s ] thds: 10 tps: 152.26 qps: 3050.10 (r/w/o: 2136.51/609.06/304.53) lat (ms,95%): 211.60 err/s: 0.00 reconn/s: 0.00
[ 15s ] thds: 10 tps: 154.38 qps: 3086.05 (r/w/o: 2159.76/617.53/308.76) lat (ms,95%): 227.40 err/s: 0.00 reconn/s: 0.00
^C

[root@l-betadb2.ops.p1 ~]# sh mgr_sysbench.sh run
sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 10
Report intermediate results every 5 second(s)
Initializing random number generator from current time


Initializing worker threads...

Threads started!

[ 5s ] thds: 10 tps: 327.44 qps: 6577.08 (r/w/o: 4608.62/1311.58/656.89) lat (ms,95%): 71.83 err/s: 0.00 reconn/s: 0.00
[ 10s ] thds: 10 tps: 387.99 qps: 7752.29 (r/w/o: 5425.92/1550.38/775.99) lat (ms,95%): 68.05 err/s: 0.00 reconn/s: 0.00
```
 
